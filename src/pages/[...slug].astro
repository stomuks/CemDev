---
import { useStoryblokApi } from '@storyblok/astro'
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro'
import BaseLayout from '../layouts/BaseLayout.astro'
import { undefined } from 'astro:schema'

export async function getStaticPaths() {
	const storyblokApi = useStoryblokApi()
	const { data } = await storyblokApi.get('cdn/links', {
		version: 'draft'
	})
	return Object.values(data.links).map((link: { slug: string }) => ({
		params: {
			slug: link.slug === 'home' ? undefined : link.slug
		}
	}))
}

const { slug } = Astro.params

const storyblokApi = useStoryblokApi()
const { data } = await storyblokApi.get(
	`cdn/stories/${slug === undefined ? 'home' : slug}`,
	{
		version: 'draft'
	}
)

const story = data.story
---

<BaseLayout>
	<StoryblokComponent blok={story.content} />
</BaseLayout>
